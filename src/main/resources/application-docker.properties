# Application Properties for Docker Deployment
# OVERRIDES ONLY - All other settings inherited from application.properties
#
# Activate with: SPRING_PROFILES_ACTIVE=docker

# ===================================================================
# DOCKER-SPECIFIC OVERRIDES
# ===================================================================

# Database Configuration - Use Docker host reference
# Using host.docker.internal to connect to PostgreSQL on host machine
spring.datasource.url=jdbc:postgresql://host.docker.internal:5432/AmmoP1DB
spring.datasource.username=${DB_USERNAME:postgres}

# Hibernate Configuration - Validate schema matches entities
# Setting to 'validate' checks that DB schema matches entity definitions without modifying anything
# This is safe for existing databases with data
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
# Note: NOT setting hibernate.jdbc.time_zone because we handle UTC in Java code with LocalDateTime.now(ZoneOffset.UTC)

# Spring Boot SQL Initialization - Disabled since database already exists with data
# mode=never prevents schema.sql from running (tables already exist on host DB)
# Use mode=always only for fresh containerized database deployments
spring.sql.init.mode=never
spring.sql.init.continue-on-error=false
spring.jpa.defer-datasource-initialization=false

# Error handling - Show errors for Docker debugging
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param

# Session Cookie Configuration - Allow cookies to work with IP addresses
server.servlet.session.cookie.domain=
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=lax

# Logging Configuration - Production-appropriate levels for Docker
logging.level.com.ammons.taskactivity=INFO
logging.level.com.ammons.taskactivity.config.DataInitializer=INFO
logging.level.com.ammons.taskactivity.service.CustomUserDetailsService=INFO
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.security.authentication=WARN
logging.level.org.springframework.security.web.authentication=WARN
logging.level.org.hibernate.SQL=INFO
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
# Log SQL script execution to verify schema.sql is running
logging.level.org.springframework.jdbc.datasource.init=INFO
logging.level.org.springframework.boot.autoconfigure=INFO

# Email Configuration - Can be overridden via environment variables
spring.mail.enabled=${MAIL_ENABLED:false}

# File Upload Configuration
# Maximum file size for receipt uploads (in bytes)
# Docker environment: 5MB (5242880 bytes)
app.upload.max-file-size=${MAX_FILE_SIZE:5242880}

# Spring Boot Multipart Configuration
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB
