# Application Properties for AWS Deployment
# OVERRIDES ONLY - All other settings inherited from application.properties
#
# Activate with: SPRING_PROFILES_ACTIVE=aws

# ===================================================================
# AWS-SPECIFIC OVERRIDES
# ===================================================================

# Server Configuration
# Port 8080 (default) - Accessed via Cloudflare Tunnel for HTTPS
# server.port=8080

# Database Configuration
# Database credentials are loaded from AWS Secrets Manager via SecretsEnvironmentPostProcessor
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/AmmoP1DB}

# Hibernate Configuration - VALIDATE ONLY (do not modify schema in production!)
# CRITICAL: Use ddl-auto=validate to prevent data loss from schema changes
spring.jpa.hibernate.ddl-auto=validate
# Note: NOT setting hibernate.jdbc.time_zone because we handle UTC in Java code with LocalDateTime.now(ZoneOffset.UTC)

# Disable SQL initialization in AWS (use Hibernate instead)
spring.sql.init.mode=never

# Defer datasource initialization until after EntityManager is ready
spring.jpa.defer-datasource-initialization=false

# Connection Pool Optimization for AWS RDS
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# CORS Configuration - Override via environment variable
# CRITICAL: Set CORS_ALLOWED_ORIGINS environment variable in ECS task definition
# for additional domains or to change the default
# Example: CORS_ALLOWED_ORIGINS=https://taskactivitytracker.com,https://www.taskactivitytracker.com
# 
# Production domain - explicit origins for security (no wildcards)
# Supports HTTPS with and without www
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://taskactivitytracker.com,https://www.taskactivitytracker.com}

# Password History Configuration - AWS Override
# Allows runtime configuration via ECS task definition environment variables
# PASSWORD_HISTORY_ENABLED - Enable/disable password history feature (true/false)
# PASSWORD_HISTORY_SIZE - Number of previous passwords to check (1-24, default: 5)
security.password.history.enabled=${PASSWORD_HISTORY_ENABLED:true}
security.password.history.size=${PASSWORD_HISTORY_SIZE:5}

# Session Configuration - HTTPS (via Cloudflare Tunnel)
# Secure flag must be true for cookies over HTTPS
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.domain=

# Logging Configuration - CloudWatch-compatible
# Production security: INFO level prevents sensitive data exposure in logs
logging.level.root=INFO
logging.level.org.hibernate.SQL=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Actuator/Health Check Configuration - Required for health monitoring
# Minimal exposure for security - only basic health status
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never
management.endpoint.health.show-components=never
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true
# Disable mail health check when using AWS SDK (it tries to use SMTP)
management.health.mail.enabled=false

# AWS Secrets Manager Configuration
# Set these environment variables before deployment:
# - AWS_SECRET_NAME (default: taskactivity/database/credentials)
# - AWS_REGION (default: us-east-1)
# These are read by SecretsEnvironmentPostProcessor

# Admin User Configuration
# Set these environment variables to override defaults:
# - ADMIN_USERNAME (default: admin)
# - ADMIN_PASSWORD (default: ChangeMe123!)

# ===================================================================
# EMAIL CONFIGURATION FOR AWS
# ===================================================================
# AWS SES SDK Method (Recommended) - Uses ECS task IAM role credentials
# Requires: ECS task role with ses:SendEmail and ses:SendRawEmail permissions
aws.region=${AWS_REGION:us-east-1}
spring.mail.enabled=${MAIL_ENABLED:false}
spring.mail.use-aws-sdk=${MAIL_USE_AWS_SDK:true}
app.mail.from=${MAIL_FROM:noreply@taskactivitytracker.com}
app.mail.admin-email=${ADMIN_EMAIL:deanammons@gmail.com}

# Optional: AWS SES Configuration Set for tracking email events
# Tracks: sends, deliveries, bounces, complaints in CloudWatch
# To enable: Create configuration set and uncomment line below
spring.mail.properties.mail.ses.configuration-set=taskactivity-emails

# SMTP Method (Alternative) - Requires SMTP credentials
# Uncomment these if you prefer SMTP instead of AWS SDK:
# spring.mail.use-aws-sdk=false
# spring.mail.host=${MAIL_HOST:email-smtp.us-east-1.amazonaws.com}
# spring.mail.port=${MAIL_PORT:587}
# spring.mail.username=${MAIL_USERNAME}
# spring.mail.password=${MAIL_PASSWORD}
# spring.mail.properties.mail.smtp.auth=true
# spring.mail.properties.mail.smtp.starttls.enable=true
# spring.mail.properties.mail.smtp.starttls.required=true

# File Upload Configuration
# Maximum file size for receipt uploads (in bytes)
# AWS environment: 8MB (8388608 bytes) for production
app.upload.max-file-size=${MAX_FILE_SIZE:8388608}

# ===================================================================
# SWAGGER/OPENAPI CONFIGURATION FOR AWS
# ===================================================================
# OpenAPI/Swagger is DISABLED in production for security
# API documentation should not be publicly accessible in production environments
# 
# For development/testing environments, you can enable it in application-local.properties
# or application-docker.properties if needed
springdoc.swagger-ui.enabled=false
springdoc.api-docs.enabled=false

# Storage Configuration
storage.type=s3
storage.s3.bucket=taskactivity-receipts-prod
storage.s3.region=us-east-1

# Spring Boot Multipart Configuration
# Must match app.upload.max-file-size (8MB for AWS)
spring.servlet.multipart.max-file-size=8MB
spring.servlet.multipart.max-request-size=8MB

# Allowed file types
storage.allowed-types=image/jpeg,image/png,image/jpg,application/pdf
